\chapter{Experimental Setup}\label{experimental_setup}
	\section{Requirements}\label{requirements}
		In order to improve on previous works \citet{Leonie}, section \ref{related_work}), we require that our method fulfills following criteria:
	\begin{itemize}
		\item \textbf{R1: Minimal distance to water surface}: This requirement defined our experimental setup. As shown in figures \ref{fig:aquarium_setup} and \ref{fig:aeolotron_setup}, lighting bubbles from below gives more freedom for the camera to be closer to the water surface. This is more apparent when the camera faces the surface with a certain angle. 
		\item \textbf{R2: Consistent image results}: Bubbles can look very different under different lighting conditions. For instance, bubbles might appear as dark disks or bright rings (chapter \ref{related_work}) depending how they are lit. We therefore require that the angle between camera and light source is always constant. This requirement guarantees a consistent pattern for bubbles across different water tanks.
		\item \textbf{R3: Images must contain all possibly retrievable information}. From our simulation (figure \ref{subfig:bubble_simulation}) we know that bubbles are characterized by two peaks. Both of these – especially the upper, dimmer one – are required to be visible. This requires the camera to have a high signal-to-noise ratio and/or the light source to be very bright. 
	\end{itemize}	
		
	\section{Aquarium Setup}
	%TODO 2 more columns for different setups
		\begin{figure}
			\centering
			\includegraphics[scale=1]{images/aquarium_setup}
			\caption{Experimental setup illustrating the $90^\circ$ angle between the light source (LED array) and the camera. Note how LEDs are also oriented towards the camera's field of view to maximize the amount of light reaching the camera and therefore reduce noise.}
			\label{fig:aquarium_setup}
		\end{figure}			
		
		The goal of this setup is to capture bubble images that can be used to prototype our algorithm, so we built the experiment in a transparent $1m \times 1m \times 1m$ water tank as shown in figure \ref{fig:aquarium_setup} where we could change most of the parameters such as lighting angle, camera and bubble concentration independently from each other. Measurement results are discussed in next chapter and image analysis is discussed in chapter \ref{the_algorithm}.
		
		In order to satisfy requirements in section \ref{requirements}, we opted for parameters as summarized in table \ref{tab:aquarium_param}. 
		
		We chose the Basler A1920 mainly because of its high signal-to-noise ratio, and therefore fulfilling requirement R3 given enough light. Its main drawback is its relatively low frame rate at the highest possible resolution, which makes bubble tracking more difficult, which in turn makes radius calibration more difficult (see section \ref{calibration_algorithm}). Compared to an available high-speed camera with comparable maximum resolution, (PCO Dimax, 1,2kHz at $2000 \times 2000$ resolution) our chosen camera also has a smaller sensor. This means that the magnification factor is higher and therefore smaller bubbles can be better detected. A 100 mm macro lens was used in this setup. The large focal length yields a large magnification factor.
%		\item \textbf{Gamma value}
%		\item \textbf{F-number} This value has been chosen such that the depth of field is a few centimeters large (see also section \ref{calibration_setup})		
	Bubbles were produced by a bubble generator. Bubble radii therefore depend on the amount of air flowing through the bubble generator, measured in liter per minute or LPM. We acquired two sets of measurements, the first with a low bubble concentration, (1,8 LPM air flow), and the second with a much higher bubble concentration (3 LPM). 
		
		\begin{table}
			\centering
		
			\begin{tabular}{|c|c|}
			\hline 
			Camera & Basler A1920-155um \\ 
			\hline 
			Focal length & 100 mm \\ 
			\hline 
			F-number & 5,6 \\ 
			\hline 
			Exposure time & 100 us \\ 
			\hline 
			Gamma & 0,8 \\
			\hline
			Resolution [px] &1920 x 1200 \\
			\hline 
			Sensor size & 11.3 mm x 7.1 mm \\
			\hline
			Air flow & 1,8 LPM / 3 LPM \\ 
			\hline 
			Magnification factor & 30 um/px \\ 
			\hline 
			Framerate & 100 Hz \\ 
			\hline 
			Resulting field of view & 5,7cm x 3,6 cm \\
			\hline
			\end{tabular} 
			
			\caption{Parameters for aquarium setup}
			\label{tab:aquarium_param}

		\end{table}
		
	\section{Aeolotron Setup}
		%TODO Table as 4.1
		The Aeolotron is an experimental annular wind-wave facility with a diameter of about 10m and a width of about 60cm. Typical water height is 1m. Four wind engines generate reference wind speeds of up to 17m/s, enough to generate breaking waves that can produce air bubbles. Figure \ref{fig:aeolotron_setup} shows a schematic view of the wind facility as well as the experimental setup.
		
		The goal of this setup is to apply the knowledge gained from the previous setup on bubbles emerging from breaking waves, so we reproduced the setup from the aquarium at the Aeolotron, while keeping as many unchanged parameters as possible (e.g. same camera, same light source same lens etc...).
		
	We also used a bubble generator first, to verify that the algorithm developed for the previous setup still works with measurements from the Aeolotron setup. Some parameters such as focus distance and angle between the light source and bubbles were inevitably changed, which means we needed to calibrate our setup again. Table \ref{tab:aeolotron_setup} summarizes the setup's parameters.
	
		\begin{table}
			\centering
		
			\begin{tabular}{|c|c|}
			\hline 
			Camera & Basler A1920-155um \\ 
			\hline 
			Focal length & 100 mm \\ 
			\hline 
			F-number & 5,6 \\ 
			\hline 
			Exposure time & 130 us \\ 
			\hline 
			Gamma & 0,7 \\
			\hline
			Resolution [px] &1920 x 1200 \\
			\hline 
			Sensor size & 11.3 mm x 7.1 mm \\
			\hline
			Air flow & 1,8 LPM  \\ 
			\hline 
			Magnification factor & 10 um/px \\ 
			\hline 
			Framerate & 100 Hz \\ 
			\hline 
			Resulting field of view & 1,9 cm x 1,2 cm \\
			\hline
			\end{tabular} 
			
			\caption{Parameters for Aeolotron setup}
			\label{tab:aeolotron_setup}

		\end{table}
		
		\begin{figure}
			\centering
			\begin{subfigure}[t]{.4\linewidth}
				\centering
				\includegraphics[scale=0.15]{images/aeolotron-gesamt.png}
				\caption{Aeolotron wind wave facility}
			\end{subfigure}
			\begin{subfigure}[t]{.4\linewidth}		
				\centering
				\includegraphics[scale=.5]{images/aeolotron_setup.png}
				\caption{Experimental setup}
			\end{subfigure}
			
			\caption{Aeolotron facility and experimental setup}
			\label{fig:aeolotron_setup}
		\end{figure}
	
		
		
	\section{Measurement result}\label{measurement_results}
		\begin{figure}			
			\begin{subfigure}[b]{.55\textwidth}
				\centering
				\includegraphics[scale=0.8]{images/aquarium_result_sat.png}
				\caption{Exposure time = 100us, Gamma = 0,6. Both peaks are dimmer than in figure \ref{subfig:aquarium_result_sat}}
			\end{subfigure}
			
			\begin{subfigure}[b]{.55\textwidth}
				\centering
				\includegraphics[scale=0.3]{images/aquarium_result_surf.png}
				\caption{Exposure time = $200 \mu s$, Gamma = 1. Lower peak is saturated but upper peak can be clearly seen}
				\label{subfig:aquarium_result_sat}
			\end{subfigure}
			\caption{Sample image captured with aquarium setup for a low bubble concentration. Note how bubbles are characterized by one bright peak at the bottom and one dimmer upper peak, as expected from simulation.}			
			\label{fig:aqauarium_result}
		\end{figure}
					
					
		\begin{figure}
			\includegraphics[scale=0.3]{images/aquarium_result_high_conc.jpg}
			\caption{Sample image captured with aquarium setup for a high bubble concentration. The upper peak is not visible anymore. However, bubble curvatures are more recognizable, even for smaller bubbles}
			\label{fig:aquarium_result_high_conc}
		\end{figure}							
					
			\begin{figure}
				\centering
				\includegraphics[scale=0.3]{images/aeolotron_result.png}
				\caption{Image captured with Aeolotron setup. Bubbles were created by a bubble generator.  Exposure time = , Gamma = }
								
				\label{fig:aeolotron_result}
			\end{figure}

			Figures \ref{fig:aqauarium_result}, \ref{fig:aquarium_result_high_conc} and \ref{fig:aeolotron_result} show different images captured using a bubble generator in two different water tanks. For low bubble concentrations, images look very similar across the two different setups. However, when the concentration is very high (figure \ref{fig:aquarium_result_high_conc}) bubbles change dramatically. The curvature can be easily distinguished and scattered light from other bubbles gives bubbles a more circular shape. Also, the background is much brighter for a high bubble concentration. The exact bubble shape will be discussed further in chapter \ref{the_algorithm}.	
	
	
	\section{Calibration}\label{calibration_setup}
		\subsection{Depth of Field}\label{sub:depth_of_field_setup}
			Since we want to determine the measurement volume, we need to not only detect bubbles in an image, but also determine their depth, i.e. distance to the focal plane. With the experimental setup shown in figure \ref{fig:depth_of_field_setup}, bubbles can be trapped and moved along the depth axis. 
			
			Figure \ref{fig:depth_of_field_setup_result} shows images captured with this setup. Note how blurriness varies among images depending on the distance to focal point. In section \ref{calibration_algorithm} we discuss how to extract depth form these images. The setup is not perfectly stable, so resulting images were not perfectly aligned. As a workaround, we took additional images with a different light source at each position to make other surrounding objects visible, e.g. armature of calibration device that can later on be used for tracking and stabilization. 
			
			This calibration technique is practical, because we do not need to determine the absolute distance to the camera. So only relative distances to focal plane are needed for a depth calibration. This is important because the goal of calibration is to determine the measurement volume only and not necessarily the absolute position of the measurement volume to the camera. 
			
			
			\begin{SCfigure}
				\centering
				\includegraphics[scale=.2]{images/depth_of_field_setup.png}
				\caption{Setup for depth of field calibration. A high friction stick attached to a micrometer screw captures bubbles. }
				\label{fig:depth_of_field_setup}
			\end{SCfigure}
			
			\begin{figure}
				\begin{subfigure}[b]{.55\textwidth}
					\centering
					\includegraphics[scale=.5]{images/dof_calib_1.png}
					\caption{}
				\end{subfigure}%
				\begin{subfigure}[b]{.55\textwidth}
					\centering
					\includegraphics[scale=.5]{images/dof_calib_2.png}
					\caption{}
				\end{subfigure}
				
				\caption{Two images from depth of field calibration setup at different distances from focal plane.}								
				\label{fig:depth_of_field_setup_result}
			\end{figure}
			
			
		\subsection{Radius}\label{sub:radius_setup}
			Although simulation shows that the distance between the two dominant peaks in a bubble is proportional to the bubble radius, we cannot determine the real radius from measurement results alone (figure \ref{fig:aqauarium_result} and \ref{fig:aeolotron_result}). So we need to change the lighting in such a way that the real radius becomes measurable, i.e. the whole bubble becomes visible. In a similar way to the light field method \cite{MischlerDiss}, we used an additional light source and a mirror in order to light up the bubbles from behind (figure \ref{fig:radius_calibration_setup}). Then, we acquired images at a frame rate of 200 FPS and lit the additional light source every second frame. Results are shown in figure \ref{fig:radius_calibration_setup_result}. In section \ref{calibration_algorithm} we identify bubbles lit from below with those lit from behind in order to estimate the proportionality factor between the real radius and the radius computed by our algorithm. 
			

			\begin{SCfigure}
				\includegraphics[scale=.5]{images/radius_setup_fancy.png}
				\caption{A view from inside the Aeolotron wind wave facility for radius calibration. The additional light source (green) is synchronized with the main light source (red).}
				\label{fig:radius_calibration_setup}
			\end{SCfigure}
			
			\begin{figure}
				\begin{subfigure}[b]{.55\textwidth}
					\centering
					\includegraphics[scale=1]{images/rad_calib_1.png}
					\caption{}
				\end{subfigure}
				\begin{subfigure}[b]{.55\textwidth}
					\centering
					\includegraphics[scale=1]{images/rad_calib_2.jpg}
					\caption{}
				\end{subfigure}
				\begin{subfigure}[b]{.55\textwidth}
					\centering
					\includegraphics[scale=1]{images/rad_calib_3.png}
					\caption{}
				\end{subfigure}
				\begin{subfigure}[b]{.55\textwidth}
					\centering
					\includegraphics[scale=1]{images/rad_calib_4.jpg}
					\caption{}
				\end{subfigure}
				
				\caption{Radius calibration images}
				\label{fig:radius_calibration_setup_result}
			\end{figure}

































